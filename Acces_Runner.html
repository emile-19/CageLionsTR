<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Accès Runner</title>
<style>
body { font-family: Arial,sans-serif; margin:0; padding:0; }
.menu-btn { font-size: 24px; cursor: pointer; position: fixed; top: 20px; left: 20px; z-index: 1000; }
.sidemenu {
    height: 100%;
    width: 0;
    position: fixed;
    z-index: 999;
    top: 0;
    left: 0;
    background-color: #111;
    overflow-x: hidden;
    transition: 0.3s;
    padding-top: 60px;
}
.sidemenu a {
    padding: 10px 20px;
    text-decoration: none;
    font-size: 18px;
    color: #f1f1f1;
    display: block;
    transition: 0.3s;
}
.sidemenu a:hover { background-color: #575757; }
.sidemenu .closebtn { position: absolute; top: 20px; right: 25px; font-size: 30px; }
.container { margin-left: 0; transition: margin-left 0.3s; padding: 20px; }

h1{margin-bottom:20px;}
.endroit-container{margin-bottom:30px;}
.endroit-container h2{margin-bottom:10px;}
table{width:100%;border-collapse:collapse;margin-top:5px;}
th,td{border:1px solid #ccc;padding:10px;text-align:left;}
.urgent{color:red;font-weight:bold;}
.encours{background-color:#d4edda;} /* vert clair */
.btn{padding:5px 10px;margin-right:5px;border:none;border-radius:5px;cursor:pointer;}
.btn-encours{background-color:#28a745;color:white;}
.btn-terminer{background-color:#dc3545;color:white;}
</style>
</head>
<body>

<!-- Menu latéral -->
<div id="sidemenu" class="sidemenu">
  <a href="javascript:void(0)" class="closebtn" onclick="closeMenu()">&times;</a>
  <a href="commande.html">Nouvelle Commande</a>
  <a href="Acces_Runner.html">Accès Runner</a>
  <a href="Livraison.html">Livraison</a>
  <a href="priv.html">Accès Privé</a>
</div>

<!-- Bouton menu -->
<div class="menu-btn" onclick="openMenu()">☰ Menu</div>

<div class="container">
<h1>Accès Runner</h1>
<div id="runnerContainer"></div>
</div>

<script>
// Menu
function openMenu() { document.getElementById("sidemenu").style.width="250px"; document.querySelector(".container").style.marginLeft="250px"; }
function closeMenu() { document.getElementById("sidemenu").style.width="0"; document.querySelector(".container").style.marginLeft="0"; }

// Commandes
const runnerContainer = document.getElementById("runnerContainer");
function afficherCommandes(){
    let commandes = JSON.parse(localStorage.getItem("commandes"))||[];
    runnerContainer.innerHTML="";
    const endroits = [...new Set(commandes.map(c=>c.endroit))];
    endroits.forEach(endroit=>{
        const div = document.createElement("div");
        div.className="endroit-container";
        div.innerHTML=`<h2>${endroit}</h2>`;
        const table=document.createElement("table");
        table.innerHTML=`<thead><tr><th>Produit</th><th>Quantité</th><th>Actions</th></tr></thead>`;
        const tbody=document.createElement("tbody");
        commandes.filter(c=>c.endroit===endroit).forEach(c=>{
            const tr=document.createElement("tr");
            tr.className=c.status==="encours"?"encours":"";
            tr.innerHTML=`
                <td class="${c.urgent?'urgent':''}">${c.produit}</td>
                <td>${c.quantite}</td>
                <td>
                    <button class="btn btn-encours" onclick="mettreEnCours('${c.id}')">En cours</button>
                    <button class="btn btn-terminer" onclick="terminerCommande('${c.id}')">Terminer</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        div.appendChild(table);
        runnerContainer.appendChild(div);
    });
}

function mettreEnCours(id){
    let commandes = JSON.parse(localStorage.getItem("commandes"))||[];
    commandes = commandes.map(c=>{ if(c.id==id)c.status="encours"; return c; });
    localStorage.setItem("commandes",JSON.stringify(commandes));
    afficherCommandes();
}
// Bouton Terminer
function terminerCommande(id) {
    let commandes = JSON.parse(localStorage.getItem("commandes")) || [];
    const index = commandes.findIndex(c => c.id === id);
    if (index !== -1) {
        const commande = commandes[index];

        // Récupérer commandes terminées depuis localStorage
        let commandes_terminees = JSON.parse(localStorage.getItem("commandes_terminees")) || [];

        // Date locale au format yyyy-mm-dd
        const d = new Date();
        const dateLocale = d.toLocaleDateString('fr-CA'); // yyyy-mm-dd

        // Ajouter la commande terminée
        commandes_terminees.push({
            date: dateLocale,
            items: commande.items || [{ nom: commande.produit, qte: commande.quantite }],
            heure: d.getHours()
        });

        localStorage.setItem("commandes_terminees", JSON.stringify(commandes_terminees));

        // Supprimer la commande de la liste active
        commandes.splice(index, 1);
        localStorage.setItem("commandes", JSON.stringify(commandes));

        // Rafraîchir l'affichage
        afficherCommandes();
    }
}




setInterval(afficherCommandes,1000);
</script>

</body>
</html>
