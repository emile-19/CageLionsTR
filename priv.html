<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>AccÃ¨s PrivÃ©</title>


<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
}


.menu-btn {
    font-size: 20px;
    padding: 10px;
    cursor: pointer;
}


.menu {
    position: fixed;
    top: 0;
    left: -250px;
    width: 250px;
    height: 100%;
    background-color: #333;
    color: white;
    transition: left 0.3s;
    padding-top: 60px;
}


.menu.ouvert { left: 0; }


.menu a {
    display: block;
    color: white;
    padding: 15px;
    text-decoration: none;
}


.menu a:hover { background-color: #444; }


.contenu { padding: 20px; }


.hidden { display: none; }


.box {
    border: 1px solid #ccc;
    padding: 15px;
    margin-top: 15px;
    border-radius: 8px;
}


.nav-jour {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 15px 0;
}


.top3 li { margin: 5px 0; }


canvas { margin-top: 20px; max-width: 100%; }


button { cursor: pointer; }
</style>
</head>


<body>


<button class="menu-btn" onclick="toggleMenu()">â˜° Menu</button>


<div id="menu" class="menu">
    <a href="main.html">Accueil</a>
    <a href="commande.html">Nouvelle Commande</a>
    <a href="Acces_Runner.html">AccÃ¨s Runner</a>
    <a href="Livraison.html">Livraison</a>
    <a href="priv.html">AccÃ¨s PrivÃ©</a>
</div>


<div class="contenu">


<!-- LOGIN -->
<div id="login">
    <h2>ğŸ” AccÃ¨s PrivÃ©</h2>
    <input type="password" id="code" maxlength="4">
    <button onclick="verifierCode()">Valider</button>
    <p id="erreur" style="color:red;"></p>
</div>


<!-- STATS -->
<div id="stats" class="hidden">


    <h2>ğŸ“Š Statistiques</h2>


    <!-- Navigation jour -->
    <div class="nav-jour">
        <button onclick="changerJour(-1)">â¬…</button>
        <strong id="jour"></strong>
        <button onclick="changerJour(1)">â¡</button>
    </div>


    <!-- Supprimer la journÃ©e -->
    <div style="text-align:center; margin-bottom:15px;">
        <button onclick="supprimerJour()">Supprimer cette journÃ©e</button>
    </div>


    <!-- Stats jour -->
    <div class="box">
        <h3>Commandes du jour</h3>
        <ul id="statsJour"></ul>
    </div>


    <!-- Top 3 jour -->
    <div class="box">
        <h3>ğŸ¥‡ğŸ¥ˆğŸ¥‰ Top 3 du jour</h3>
        <ol id="topJour"></ol>
    </div>


    <!-- Top 3 global -->
    <div class="box">
        <h3>ğŸ“ˆ Top 3 global</h3>
        <ol id="topGlobal"></ol>
    </div>


    <!-- Graphique occupation par heure -->
    <div class="box">
        <h3>ğŸ“ˆ Taux d'occupation par heure</h3>
        <canvas id="graphHeure"></canvas>
    </div>


    <!-- Comparaison -->
    <div class="box">
        <h3>ğŸ“… Comparaison entre deux journÃ©es</h3>
        <input type="date" id="jourA">
        <input type="date" id="jourB">
        <button onclick="comparer()">Comparer</button>
        <p id="resultatCompare"></p>
    </div>


</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const CODE = "8743";
let offsetJour = 0;
let chartHeure = null;


function toggleMenu() {
    document.getElementById("menu").classList.toggle("ouvert");
}


function verifierCode() {
    if (document.getElementById("code").value === CODE) {
        document.getElementById("login").classList.add("hidden");
        document.getElementById("stats").classList.remove("hidden");
        afficher();
    } else {
        document.getElementById("erreur").textContent = "Code incorrect";
    }
}


// Retourne la date locale yyyy-mm-dd
function dateISO(offset = 0) {
    const d = new Date();
    d.setDate(d.getDate() + offset);
    return d.toLocaleDateString('fr-CA');
}


function changerJour(d) {
    offsetJour += d;
    afficher();
}


function afficher() {
    const jour = dateISO(offsetJour);
    document.getElementById("jour").textContent = jour;


    const data = JSON.parse(localStorage.getItem("commandes_terminees")) || [];
    const duJour = data.filter(c => c.date === jour);


    afficherStats(duJour, "statsJour");
    afficherTop(duJour, "topJour");
    afficherTop(data, "topGlobal");
    afficherGraph(duJour);
}


function afficherStats(commandes, cible) {
    const ul = document.getElementById(cible);
    ul.innerHTML = "";
    let total = {};
    commandes.forEach(c => {
        c.items.forEach(i => {
            total[i.nom] = (total[i.nom] || 0) + i.qte;
        });
    });
    for (let p in total) {
        const li = document.createElement("li");
        li.textContent = `${p} : ${total[p]}`;
        ul.appendChild(li);
    }
}


function afficherTop(commandes, cible) {
    let total = {};
    commandes.forEach(c => {
        c.items.forEach(i => {
            total[i.nom] = (total[i.nom] || 0) + i.qte;
        });
    });
    const medals = ["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];
    const top = Object.entries(total)
        .sort((a,b)=>b[1]-a[1])
        .slice(0,3);
    const ol = document.getElementById(cible);
    ol.innerHTML = "";
    top.forEach((t,i)=>{
        const li = document.createElement("li");
        li.textContent = `${medals[i]} ${t[0]} (${t[1]})`;
        ol.appendChild(li);
    });
}


function afficherGraph(commandes) {
    const heures = Array.from({length:24},(_,i)=>i);
    let occ = Array(24).fill(0);
    commandes.forEach(c => {
        c.items.forEach(i => {
            const h = c.heure;
            occ[h] += i.qte;
        });
    });
    occ = occ.map(x => x>30?30:x);


    const ctx = document.getElementById('graphHeure').getContext('2d');
    if(chartHeure) chartHeure.destroy();


    chartHeure = new Chart(ctx, {
        type: 'line',
        data: {
            labels: heures.map(h => h+":00"),
            datasets: [{
                label: 'Taux d\'occupation',
                data: occ,
                borderColor: 'blue',
                backgroundColor: 'rgba(0,0,255,0.2)',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            scales: { y: { beginAtZero:true, max:50 } }
        }
    });
}


// Supprimer une journÃ©e
function supprimerJour() {
    const jour = dateISO(offsetJour);
    if(confirm(`Voulez-vous vraiment supprimer toutes les commandes du jour ${jour} ?`)) {
        let data = JSON.parse(localStorage.getItem("commandes_terminees")) || [];
        data = data.filter(c => c.date !== jour);
        localStorage.setItem("commandes_terminees", JSON.stringify(data));
        afficher();
    }
}


// Comparer deux journÃ©es
function comparer() {
    const a = document.getElementById("jourA").value;
    const b = document.getElementById("jourB").value;
    if(!a || !b) { alert("SÃ©lectionnez les deux dates !"); return; }


    const data = JSON.parse(localStorage.getItem("commandes_terminees")) || [];
    const totalA = data.filter(c=>c.date===a).reduce((sum,c)=>sum+c.items.reduce((s,i)=>s+i.qte,0),0);
    const totalB = data.filter(c=>c.date===b).reduce((sum,c)=>sum+c.items.reduce((s,i)=>s+i.qte,0),0);


    document.getElementById("resultatCompare").textContent = `${a} : ${totalA} produits | ${b} : ${totalB} produits`;
}

</script>
</body>
</html>


